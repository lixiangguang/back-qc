import { useState, useEffect } from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport styles from '../styles/UserManagement.module.css';\n\ntype User = {\n  id: number;\n  phone: string;\n  usedPoints: number;\n  remainingPoints: number;\n  type: string;\n  status: string;\n  lastLogin: string;\n  registerTime: string;\n};\n\nexport default function UserManagement() {\n  const router = useRouter();\n  const [isClient, setIsClient] = useState(false);\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n  const [phone, setPhone] = useState('');\n  const [userType, setUserType] = useState('å…¨éƒ¨ç±»å‹');\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize] = useState(10);\n  const [totalUsers, setTotalUsers] = useState(0);\n  const [isLoading, setIsLoading] = useState(true);\n  \n  const [userList, setUserList] = useState<User[]>([]);\n\n  // ä»APIè·å–ç”¨æˆ·æ•°æ®\n  const fetchUsers = async () => {\n    setIsLoading(true);\n    try {\n      // æ„å»ºæŸ¥è¯¢å‚æ•°\n      const params = new URLSearchParams();\n      if (startDate) params.append('startDate', startDate);\n      if (endDate) params.append('endDate', endDate);\n      if (phone) params.append('phone', phone);\n      if (userType !== 'å…¨éƒ¨ç±»å‹') params.append('userType', userType);\n      params.append('page', currentPage.toString());\n      params.append('pageSize', pageSize.toString());\n      \n      const response = await fetch(`/api/users?${params.toString()}`);\n      const data = await response.json();\n      \n      setUserList(data.data);\n      setTotalUsers(data.total);\n    } catch (error) {\n      console.error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // å½“é¡µé¢åŠ è½½æˆ–æœç´¢æ¡ä»¶/é¡µç å˜æ›´æ—¶è·å–æ•°æ®\n  useEffect(() => {\n    if (isClient) {\n      fetchUsers();\n    }\n  }, [isClient, currentPage, pageSize]);\n\n  const handleSearch = () => {\n    setCurrentPage(1);  // é‡ç½®ä¸ºç¬¬ä¸€é¡µ\n    fetchUsers();\n  };\n\n  // å¤„ç†å……å€¼æ“ä½œ\n  const handleCharge = (userId: number) => {\n    console.log(`ä¸ºç”¨æˆ·ID ${userId} å……å€¼`);\n    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ‰“å¼€å……å€¼å¯¹è¯æ¡†æˆ–å¯¼èˆªåˆ°å……å€¼é¡µé¢\n  };\n\n  // å¤„ç†å°ç¦/è§£å°æ“ä½œ\n  const handleBanUnban = (userId: number, currentStatus: string) => {\n    const newStatus = currentStatus === 'ç¦ç”¨' ? 'æ­£å¸¸' : 'ç¦ç”¨';\n    console.log(`å°†ç”¨æˆ·ID ${userId} çš„çŠ¶æ€ä¿®æ”¹ä¸º ${newStatus}`);\n    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨APIæ¥æ›´æ–°ç”¨æˆ·çŠ¶æ€\n    // ç„¶åé‡æ–°è·å–ç”¨æˆ·åˆ—è¡¨\n    // fetchUsers();\n  };\n\n  // æ£€æŸ¥æ˜¯å¦åœ¨å®¢æˆ·ç«¯ï¼Œç„¶åè®¿é—®localStorage\n  useEffect(() => {\n    setIsClient(true);\n    const userPhone = localStorage.getItem('userPhone');\n    \n    if (!userPhone) {\n      router.push('/login');\n    }\n  }, [router]);\n\n  // è®¡ç®—æ€»é¡µæ•°\n  const totalPages = Math.ceil(totalUsers / pageSize);\n\n  return (\n    <div className={styles.container}>\n      <Head>\n        <title>ç”¨æˆ·ç®¡ç† - é’å®¸é“å…»æ™ºèƒ½ä½“ä¸­å¿ƒ</title>\n        <meta name=\"description\" content=\"é’å®¸é“å…»æ™ºèƒ½ä½“ä¸­å¿ƒ - ç”¨æˆ·ç®¡ç†é¡µé¢\" />\n        <link rel=\"icon\" href=\"/favicon.ico\" />\n      </Head>\n\n      {isClient ? (\n        <>\n          <div className={styles.layout}>\n            {/* ä¾§è¾¹æ  */}\n            <div className={styles.sidebar}>\n              <div className={styles.logo}>\n                <span className={styles.logoText}>é’å®¸é“å…»æ™ºèƒ½ä½“ä¸­å¿ƒ</span>\n              </div>\n              <nav className={styles.nav}>\n                <Link href=\"/\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>ğŸ </i>\n                    <span>å¼€å§‹å·¥ä½œ</span>\n                  </div>\n                </Link>\n                <Link href=\"/inspiration\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>ğŸ’¡</i>\n                    <span>é€‰é¢˜çµæ„Ÿ</span>\n                  </div>\n                </Link>\n                <Link href=\"/content\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>ğŸ“</i>\n                    <span>å†…å®¹ç”Ÿäº§</span>\n                  </div>\n                </Link>\n                <Link href=\"/publish\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>ğŸ”„</i>\n                    <span>ä½œå“å‘å¸ƒ</span>\n                  </div>\n                </Link>\n                <Link href=\"/user-management\" className={styles.active}>\n                  <div className={styles.navItemActive}>\n                    <i className={styles.icon}>ğŸ‘¥</i>\n                    <span>ç”¨æˆ·ç®¡ç†</span>\n                  </div>\n                </Link>\n                <Link href=\"/tasks\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>âœ…</i>\n                    <span>æ¯æ—¥ä»»åŠ¡</span>\n                  </div>\n                </Link>\n                <Link href=\"/data-statistics\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>ğŸ“Š</i>\n                    <span>æ•°æ®ç»Ÿè®¡</span>\n                  </div>\n                </Link>\n                <Link href=\"/system-settings\">\n                  <div className={styles.navItem}>\n                    <i className={styles.icon}>âš™ï¸</i>\n                    <span>ç³»ç»Ÿè®¾ç½®</span>\n                  </div>\n                </Link>\n              </nav>\n            </div>\n\n            {/* ä¸»å†…å®¹åŒºåŸŸ */}\n            <div className={styles.content}>\n              <div className={styles.header}>\n                <h2 className={styles.pageTitle}>ç”¨æˆ·ç®¡ç†</h2>\n              </div>\n              \n              {/* æœç´¢åŒºåŸŸ */}\n              <div className={styles.searchPanel}>\n                <div className={styles.searchForm}>\n                  <div className={styles.formGroup}>\n                    <label className={styles.label}>æ³¨å†Œæ—¥æœŸ</label>\n                    <div className={styles.dateRangePicker}>\n                      <input \n                        type=\"date\" \n                        className={styles.dateInput}\n                        value={startDate}\n                        onChange={(e) => setStartDate(e.target.value)}\n                        placeholder=\"-/-/-\"\n                      />\n                      <span className={styles.dateRangeSeparator}>è‡³</span>\n                      <input \n                        type=\"date\" \n                        className={styles.dateInput}\n                        value={endDate}\n                        onChange={(e) => setEndDate(e.target.value)}\n                        placeholder=\"-/-/-\"\n                      />\n                    </div>\n                  </div>\n                  \n                  <div className={styles.formGroup}>\n                    <label className={styles.label}>ç±»å‹</label>\n                    <select \n                      className={styles.select}\n                      value={userType}\n                      onChange={(e) => setUserType(e.target.value)}\n                    >\n                      <option value=\"å…¨éƒ¨ç±»å‹\">å…¨éƒ¨ç±»å‹</option>\n                      <option value=\"ä»˜è´¹ç”¨æˆ·\">ä»˜è´¹ç”¨æˆ·</option>\n                      <option value=\"å…è´¹ç”¨æˆ·\">å…è´¹ç”¨æˆ·</option>\n                    </select>\n                  </div>\n                  \n                  <div className={styles.formGroup}>\n                    <label className={styles.label}>æ‰‹æœºå·ç </label>\n                    <input \n                      type=\"text\" \n                      className={styles.input}\n                      value={phone}\n                      onChange={(e) => setPhone(e.target.value)}\n                      placeholder=\"è¯·è¾“å…¥æ‰‹æœºå·ç \"\n                    />\n                  </div>\n                  \n                  <div className={styles.searchBtnWrapper}>\n                    <button className={styles.searchBtn} onClick={handleSearch}>\n                      <i className={styles.searchIcon}>ğŸ”</i>\n                      æœç´¢\n                    </button>\n                  </div>\n                </div>\n              </div>\n              \n              {/* ç”¨æˆ·åˆ—è¡¨ */}\n              <div className={styles.userListPanel}>\n                <div className={styles.panelHeader}>\n                  <h3 className={styles.panelTitle}>ç”¨æˆ·åˆ—è¡¨</h3>\n                </div>\n                \n                <div className={styles.tableContainer}>\n                  {isLoading ? (\n                    <div className={styles.tableLoading}>æ•°æ®åŠ è½½ä¸­...</div>\n                  ) : userList.length === 0 ? (\n                    <div className={styles.tableEmpty}>æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·æ•°æ®</div>\n                  ) : (\n                    <table className={styles.userTable}>\n                      <thead>\n                        <tr>\n                          <th>No</th>\n                          <th>æ³¨å†Œæ‰‹æœºå·</th>\n                          <th>å·²ç”¨ç§¯åˆ†</th>\n                          <th>å‰©ä½™ç§¯åˆ†</th>\n                          <th>ç±»å‹</th>\n                          <th>çŠ¶æ€</th>\n                          <th>æœ€åç™»å½•æ—¶é—´</th>\n                          <th>æ³¨å†Œæ—¶é—´</th>\n                          <th>æ“ä½œ</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {userList.map((user) => (\n                          <tr key={user.id}>\n                            <td>{user.id}</td>\n                            <td>{user.phone}</td>\n                            <td>{user.usedPoints}</td>\n                            <td>{user.remainingPoints}</td>\n                            <td>{user.type}</td>\n                            <td>{user.status}</td>\n                            <td>{user.lastLogin}</td>\n                            <td>{user.registerTime}</td>\n                            <td>\n                              <div className={styles.actionBtns}>\n                                <button \n                                  className={styles.chargeBtn}\n                                  onClick={() => handleCharge(user.id)}\n                                >\n                                  å……å€¼\n                                </button>\n                                <button \n                                  className={user.status === 'ç¦ç”¨' ? styles.unbanBtn : styles.banBtn}\n                                  onClick={() => handleBanUnban(user.id, user.status)}\n                                >\n                                  {user.status === 'ç¦ç”¨' ? 'è§£å°' : 'å°ç¦'}\n                                </button>\n                              </div>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  )}\n                </div>\n                \n                {/* åˆ†é¡µæ§ä»¶ */}\n                {!isLoading && userList.length > 0 && (\n                  <div className={styles.pagination}>\n                    <button \n                      className={styles.pageBtn}\n                      disabled={currentPage === 1}\n                      onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n                    >\n                      ä¸Šä¸€é¡µ\n                    </button>\n                    <div className={styles.pageInfo}>\n                      {currentPage} / {totalPages}\n                    </div>\n                    <button \n                      className={styles.pageBtn}\n                      disabled={currentPage >= totalPages}\n                      onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n                    >\n                      ä¸‹ä¸€é¡µ\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </>\n      ) : (\n        <div className={styles.loading}>åŠ è½½ä¸­...</div>\n      )}\n    </div>\n  );\n}